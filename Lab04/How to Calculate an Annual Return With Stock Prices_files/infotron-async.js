/*!
  * Reqwest! A general purpose XHR connection manager
  * license MIT (c) Dustin Diaz 2014
  * https://github.com/ded/reqwest
  */
!function(e,t,n){typeof module!="undefined"&&module.exports?module.exports=n():typeof define=="function"&&define.amd?define(n):t[e]=n()}("reqwest",this,function(){function handleReadyState(e,t,n){return function(){if(e._aborted)return n(e.request);e.request&&e.request[readyState]==4&&(e.request.onreadystatechange=noop,twoHundo.test(e.request.status)?t(e.request):n(e.request))}}function setHeaders(e,t){var n=t.headers||{},r;n.Accept=n.Accept||defaultHeaders.accept[t.type]||defaultHeaders.accept["*"],!t.crossOrigin&&!n[requestedWith]&&(n[requestedWith]=defaultHeaders.requestedWith),n[contentType]||(n[contentType]=t.contentType||defaultHeaders.contentType);for(r in n)n.hasOwnProperty(r)&&"setRequestHeader"in e&&e.setRequestHeader(r,n[r])}function setCredentials(e,t){typeof t.withCredentials!="undefined"&&typeof e.withCredentials!="undefined"&&(e.withCredentials=!!t.withCredentials)}function generalCallback(e){lastValue=e}function urlappend(e,t){return e+(/\?/.test(e)?"&":"?")+t}function handleJsonp(e,t,n,r){var i=uniqid++,s=e.jsonpCallback||"callback",o=e.jsonpCallbackName||reqwest.getcallbackPrefix(i),u=new RegExp("((^|\\?|&)"+s+")=([^&]+)"),a=r.match(u),f=doc.createElement("script"),l=0,c=navigator.userAgent.indexOf("MSIE 10.0")!==-1;return a?a[3]==="?"?r=r.replace(u,"$1="+o):o=a[3]:r=urlappend(r,s+"="+o),win[o]=generalCallback,f.type="text/javascript",f.src=r,f.async=!0,typeof f.onreadystatechange!="undefined"&&!c&&(f.htmlFor=f.id="_reqwest_"+i),f.onload=f.onreadystatechange=function(){if(f[readyState]&&f[readyState]!=="complete"&&f[readyState]!=="loaded"||l)return!1;f.onload=f.onreadystatechange=null,f.onclick&&f.onclick(),t(lastValue),lastValue=undefined,head.removeChild(f),l=1},head.appendChild(f),{abort:function(){f.onload=f.onreadystatechange=null,n({},"Request is aborted: timeout",{}),lastValue=undefined,head.removeChild(f),l=1}}}function getRequest(e,t){var n=this.o,r=(n.method||"GET").toUpperCase(),i=typeof n=="string"?n:n.url,s=n.processData!==!1&&n.data&&typeof n.data!="string"?reqwest.toQueryString(n.data):n.data||null,o,u=!1;return(n["type"]=="jsonp"||r=="GET")&&s&&(i=urlappend(i,s),s=null),n["type"]=="jsonp"?handleJsonp(n,e,t,i):(o=n.xhr&&n.xhr(n)||xhr(n),o.open(r,i,n.async===!1?!1:!0),setHeaders(o,n),setCredentials(o,n),win[xDomainRequest]&&o instanceof win[xDomainRequest]?(o.onload=e,o.onerror=t,o.onprogress=function(){},u=!0):o.onreadystatechange=handleReadyState(this,e,t),n.before&&n.before(o),u?setTimeout(function(){o.send(s)},200):o.send(s),o)}function Reqwest(e,t){this.o=e,this.fn=t,init.apply(this,arguments)}function setType(e){if(e.match("json"))return"json";if(e.match("javascript"))return"js";if(e.match("text"))return"html";if(e.match("xml"))return"xml"}function init(o,fn){function complete(e){o.timeout&&clearTimeout(self.timeout),self.timeout=null;while(self._completeHandlers.length>0)self._completeHandlers.shift()(e)}function success(resp){var type=o.type||setType(resp.getResponseHeader("Content-Type"));resp=type!=="jsonp"?self.request:resp;var filteredResponse=globalSetupOptions.dataFilter(resp.responseText,type),r=filteredResponse;try{resp.responseText=r}catch(e){}if(r)switch(type){case"json":try{resp=win.JSON?win.JSON.parse(r):eval("("+r+")")}catch(err){return error(resp,"Could not parse JSON in response",err)}break;case"js":resp=eval(r);break;case"html":resp=r;break;case"xml":resp=resp.responseXML&&resp.responseXML.parseError&&resp.responseXML.parseError.errorCode&&resp.responseXML.parseError.reason?null:resp.responseXML}self._responseArgs.resp=resp,self._fulfilled=!0,fn(resp),self._successHandler(resp);while(self._fulfillmentHandlers.length>0)resp=self._fulfillmentHandlers.shift()(resp);complete(resp)}function error(e,t,n){e=self.request,self._responseArgs.resp=e,self._responseArgs.msg=t,self._responseArgs.t=n,self._erred=!0;while(self._errorHandlers.length>0)self._errorHandlers.shift()(e,t,n);complete(e)}this.url=typeof o=="string"?o:o.url,this.timeout=null,this._fulfilled=!1,this._successHandler=function(){},this._fulfillmentHandlers=[],this._errorHandlers=[],this._completeHandlers=[],this._erred=!1,this._responseArgs={};var self=this;fn=fn||function(){},o.timeout&&(this.timeout=setTimeout(function(){self.abort()},o.timeout)),o.success&&(this._successHandler=function(){o.success.apply(o,arguments)}),o.error&&this._errorHandlers.push(function(){o.error.apply(o,arguments)}),o.complete&&this._completeHandlers.push(function(){o.complete.apply(o,arguments)}),this.request=getRequest.call(this,success,error)}function reqwest(e,t){return new Reqwest(e,t)}function normalize(e){return e?e.replace(/\r?\n/g,"\r\n"):""}function serial(e,t){var n=e.name,r=e.tagName.toLowerCase(),i=function(e){e&&!e.disabled&&t(n,normalize(e.attributes.value&&e.attributes.value.specified?e.value:e.text))},s,o,u,a;if(e.disabled||!n)return;switch(r){case"input":/reset|button|image|file/i.test(e.type)||(s=/checkbox/i.test(e.type),o=/radio/i.test(e.type),u=e.value,(!s&&!o||e.checked)&&t(n,normalize(s&&u===""?"on":u)));break;case"textarea":t(n,normalize(e.value));break;case"select":if(e.type.toLowerCase()==="select-one")i(e.selectedIndex>=0?e.options[e.selectedIndex]:null);else for(a=0;e.length&&a<e.length;a++)e.options[a].selected&&i(e.options[a])}}function eachFormElement(){var e=this,t,n,r=function(t,n){var r,i,s;for(r=0;r<n.length;r++){s=t[byTag](n[r]);for(i=0;i<s.length;i++)serial(s[i],e)}};for(n=0;n<arguments.length;n++)t=arguments[n],/input|select|textarea/i.test(t.tagName)&&serial(t,e),r(t,["input","select","textarea"])}function serializeQueryString(){return reqwest.toQueryString(reqwest.serializeArray.apply(null,arguments))}function serializeHash(){var e={};return eachFormElement.apply(function(t,n){t in e?(e[t]&&!isArray(e[t])&&(e[t]=[e[t]]),e[t].push(n)):e[t]=n},arguments),e}function buildParams(e,t,n,r){var i,s,o,u=/\[\]$/;if(isArray(t))for(s=0;t&&s<t.length;s++)o=t[s],n||u.test(e)?r(e,o):buildParams(e+"["+(typeof o=="object"?s:"")+"]",o,n,r);else if(t&&t.toString()==="[object Object]")for(i in t)buildParams(e+"["+i+"]",t[i],n,r);else r(e,t)}var win=window,doc=document,twoHundo=/^(20\d|1223)$/,byTag="getElementsByTagName",readyState="readyState",contentType="Content-Type",requestedWith="X-Requested-With",head=doc[byTag]("head")[0],uniqid=0,callbackPrefix="reqwest_"+ +(new Date),lastValue,xmlHttpRequest="XMLHttpRequest",xDomainRequest="XDomainRequest",noop=function(){},isArray=typeof Array.isArray=="function"?Array.isArray:function(e){return e instanceof Array},defaultHeaders={contentType:"application/x-www-form-urlencoded",requestedWith:xmlHttpRequest,accept:{"*":"text/javascript, text/html, application/xml, text/xml, */*",xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript",js:"application/javascript, text/javascript"}},xhr=function(e){if(e.crossOrigin===!0){var t=win[xmlHttpRequest]?new XMLHttpRequest:null;if(t&&"withCredentials"in t)return t;if(win[xDomainRequest])return new XDomainRequest;throw new Error("Browser does not support cross-origin requests")}return win[xmlHttpRequest]?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")},globalSetupOptions={dataFilter:function(e){return e}};return Reqwest.prototype={abort:function(){this._aborted=!0,this.request.abort()},retry:function(){init.call(this,this.o,this.fn)},then:function(e,t){return e=e||function(){},t=t||function(){},this._fulfilled?this._responseArgs.resp=e(this._responseArgs.resp):this._erred?t(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):(this._fulfillmentHandlers.push(e),this._errorHandlers.push(t)),this},always:function(e){return this._fulfilled||this._erred?e(this._responseArgs.resp):this._completeHandlers.push(e),this},fail:function(e){return this._erred?e(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):this._errorHandlers.push(e),this}},reqwest.serializeArray=function(){var e=[];return eachFormElement.apply(function(t,n){e.push({name:t,value:n})},arguments),e},reqwest.serialize=function(){if(arguments.length===0)return"";var e,t,n=Array.prototype.slice.call(arguments,0);return e=n.pop(),e&&e.nodeType&&n.push(e)&&(e=null),e&&(e=e.type),e=="map"?t=serializeHash:e=="array"?t=reqwest.serializeArray:t=serializeQueryString,t.apply(null,n)},reqwest.toQueryString=function(e,t){var n,r,i=t||!1,s=[],o=encodeURIComponent,u=function(e,t){t="function"==typeof t?t():t==null?"":t,s[s.length]=o(e)+"="+o(t)};if(isArray(e))for(r=0;e&&r<e.length;r++)u(e[r].name,e[r].value);else for(n in e)e.hasOwnProperty(n)&&buildParams(n,e[n],i,u);return s.join("&").replace(/%20/g,"+")},reqwest.getcallbackPrefix=function(){return callbackPrefix},reqwest.compat=function(e,t){return e&&(e.type&&(e.method=e.type)&&delete e.type,e.dataType&&(e.type=e.dataType),e.jsonpCallback&&(e.jsonpCallbackName=e.jsonpCallback)&&delete e.jsonpCallback,e.jsonp&&(e.jsonpCallback=e.jsonp)),new Reqwest(e,t)},reqwest.ajaxSetup=function(e){e=e||{};for(var t in e)globalSetupOptions[t]=e[t]},reqwest})
﻿
window.dataLayer=window.dataLayer||[];(function(global,document){global.InfotronQueue=global.InfotronQueue||function(){return{EventName:"overrideInPage",Queue:null,AllKeysInPage:null,AllCallsRegistered:false,PageId:Math.floor((Math.random()*100000000)+1),Register:function(placementId){this.Queue=this.Queue||{};this.AllKeysInPage=this.AllKeysInPage||{};this.Queue[placementId]=1;this.AllKeysInPage[placementId]=1;},Unregister:function(placementId){delete this.Queue[placementId];if(this.IsReadyToFire()){this.Complete();}else{}},Length:function(){var length=0;for(key in this.Queue){if(this.Queue.hasOwnProperty(key)){length++;}}
return length;},EndOfPage:function(eventName){this.EventName=eventName;this.AllCallsRegistered=true;if(this.IsReadyToFire()){this.Complete();}else{}},IsReadyToFire:function(){return((document.readyState==="complete"||document.readyState==="interactive")&&this.Length()==0);},Complete:function(){window.dataLayer.push({'event':this.EventName});}};}();global.infotronQueue=global.infotronQueue||global.InfotronQueue;})(window,document);(function(global,document){var pitcherAds=global.PitcherAds;global.FoolAds=global.FoolAds||{};PitcherAds=function(global){return{Url:"//infotron.fool.com/pitcher/get_pitch",TestUrl:"//test.infotron.fool.com/pitcher/get_pitch",SkipInfotron:false,asyncDFP:true,get:function(params){var self=this;if(typeof(params)==="undefined"){params={};}
params['pageId']=global.InfotronQueue.PageId;var unitName='ad_'+Math.floor((Math.random()*100000000)+1);if(this.SkipInfotron||(typeof(reqwest)==="undefined")||(typeof(params.placement)!=="undefined"&&params.placement!=="promobox"&&params.placement!=="tickerpage")){self.makeDFPAd(params);return;}
self.RegisterQueue(unitName);var url=self.Url;var host=global.location.hostname;if(host==="test.www.fool.com"||host==="staging.www.fool.com"){url=self.TestUrl;}
reqwest({url:url,data:params,timeout:3000,type:'jsonp',crossOrigin:true,error:function(err,msg){if(msg==="Request is aborted: timeout"){self.SkipInfotron=true;}
self.makeDFPAd(params);self.UnRegisterQueue(unitName);},success:function(resp){self.UnRegisterQueue(unitName);if(resp.length==0){self.makeDFPAd(params);}else{if(document.readyState==="interactive"||document.readyState==="complete"){self.PlaceAdInPage(params.divId,resp);}else{global.FoolAds[params.divId]=resp;}}}});},makeDFPAd:function(params){var self=this;if(typeof(googletag)==="undefined"){return;}
var sizes=[params.width,params.height];if(params.height=="300"&&params.width=="250"){sizes=[[300,250],[300,600]];}
googletag.cmd.push(function(){googletag.setAdIframeTitle("Advertisement");});if(self.asyncDFP){googletag.cmd.push(function(){var slot=googletag.defineSlot("/3910/"+params.site+"/"+params.zone,sizes,params.divId).addService(googletag.pubads()).setTargeting("pos",params.pos).setTargeting("seg",params.seg).setTargeting("src",params.src).setTargeting("tile",params.tile).setCollapseEmptyDiv(true,true);if(typeof(params.adtags)!=="undefined"){slot.setTargeting("adtags",params.adtags);}
googletag.enableServices();googletag.display(params.divId);});}else{var slot=googletag.defineSlot("/3910/"+params.site+"/"+params.zone,sizes,params.divId).addService(googletag.pubads()).setTargeting("pos",params.pos).setTargeting("seg",params.seg).setTargeting("src",params.src).setTargeting("tile",params.tile).setCollapseEmptyDiv(true,true);if(typeof(params.adtags)!=="undefined"){slot.setTargeting("adtags",params.adtags);}
googletag.pubads().enableSyncRendering();googletag.enableServices();googletag.display(params.divId);}},OnDomReady:function(){for(var key in global.FoolAds){this.PlaceAdInPage(key,global.FoolAds[key]);delete global.FoolAds[key];}
global.dataLayer=dataLayer||[];global.dataLayer.push({'event':'PitcherAdsComplete'});},PlaceAdInPage:function(divId,value){var element=document.getElementById(divId);element.innerHTML=value;try{var scriptTags=element.getElementsByTagName("script");for(var i=0;i<scriptTags.length;i++){eval(scriptTags[i].text);}}
catch(err){if(typeof(console)!=="undefined"&&typeof(console.error)!=="undefined"){console.error(err);}}},RegisterQueue:function(name){global.InfotronQueue.Register(name);},UnRegisterQueue:function(name){global.InfotronQueue.Unregister(name);}};}(global);for(var i=0;i<pitcherAds.length;i++){var item=pitcherAds[i];var method=item.shift();var pitcherAdsMethod=PitcherAds[method];if(pitcherAdsMethod&&!pitcherAdsMethod.stub){pitcherAdsMethod.apply(PitcherAds,item);}}
global.PitcherAds=PitcherAds;})(window,document);var dataLayer=dataLayer||[];(function(global,document){global.PitchEngine=global.PitchEngine||{};var pitchEngine=global.PitchEngine;PitchEngine=function(){return{Url:"//infotron.fool.com/pitcher/get_pitch",ContainsPitchBase:false,tryParseInt:function(str,defaultValue){var retValue=defaultValue;if(str!=null){if(str.length>0){if(!isNaN(str)){retValue=parseInt(str);}}}
return retValue;},initialize:function(param){var self=this;var host=global.location.host.split('.')[0];if((host==="mockup"||host==="staging"||host==="test")&&self.Url.indexOf(host)===-1){self.Url=self.Url.replace('infotron.fool.com',host+'.infotron.fool.com');}
self.get(param);},get:function(param){if(global.InfotronQueue){param['pageId']=global.InfotronQueue.PageId;}
var self=this;self.RegisterQueue(param.pitchContainer);self.ContainsPitchBase=param.containsPitchBase;self.Params=param;reqwest({url:self.Url,data:param,timeout:3000,type:'jsonp',crossOrigin:true,error:function(err,msg){self.pitcherError(param.pitchContainer);},success:function(resp){self.pitcherDone(param.placement,param.pitchContainer,resp);}});},pitcherDone:function(placement,unitName,data){var self=this;self.UnRegisterQueue(unitName);if(data.length>0){if(document.getElementById(unitName)!=null){self.placeInPage(unitName,data)
global.dataLayer.push({'customPitch':'false'});}
else if(placement=="article_pitch"&&(document.getElementById('pitcherPitch')!=null)){global.dataLayer.push({'customPitch':'false'});global.dataLayer.push({'fallBackPitch':'true'});self.placeInPage('pitcherPitch',data);}
else{global.dataLayer.push({'customPitch':'true'});}}},placeInPage:function(divId,value){var element=document.getElementById(divId);element.innerHTML=value;try{var scriptTags=element.getElementsByTagName('script');for(var i=0;i<scriptTags.length;i++){if(scriptTags[i].src!=''){var invokeScript=document.createElement('script');invokeScript.type='text/javascript';invokeScript.async=true;invokeScript.src=scriptTags[i].src;var firstScript=document.getElementsByTagName('script')[0];firstScript.parentNode.insertBefore(invokeScript,firstScript);}else{eval(scriptTags[i].text);}}}
catch(err){if(typeof(console)!=="undefined"&&typeof(console.error)!=="undefined"){console.error(err);}}},pitcherError:function(unitName){var self=this;self.UnRegisterQueue(unitName);},RegisterQueue:function(name){if(global.InfotronQueue){global.InfotronQueue.Register(name);}},UnRegisterQueue:function(name){if(global.InfotronQueue){global.InfotronQueue.Unregister(name);}}};}();FoolPitchEngineTracker=function(){return{DataLayer:null,EventType:"articlePageView",initialize:function(dataLayer,eventType){if(typeof dataLayer!=='undefined'){this.DataLayer=dataLayer;}
else{this.DataLayer=global.dataLayer;}
if(eventType!=""){this.EventType=eventType;}},CustomPitch:function(trueOrFalse){this.DataLayer.push({'customPitch':trueOrFalse});},Track:function(){this.DataLayer.push({'event':'articlePageView'});}};};var myPitchEngine=PitchEngine;for(var i=0;i<pitchEngine.length;i++){var item=pitchEngine[i];var method=item.shift();var pitchEngineMethod=myPitchEngine[method];if(pitchEngineMethod&&!pitchEngineMethod.stub){pitchEngineMethod.apply(myPitchEngine,item);}}
global.PitchEngine=PitchEngine;})(window,document);